---
title: "hw5_ilz2105"
author: "Lulu Zhang"
date: "11/2/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

__Problem 1__ 

```{r}
library(tidyverse)
library(rvest)
library(readr)

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

For numeric variables, you should fill in missing values with the mean of non-missing values
For character variables, you should fill in missing values with "virginica"

```{r}
iris_with_missing
# replace some species with NA's
#iris_with_missing[,"Species"] <- as.character(iris_with_missing[,"Species"])
iris_with_missing[c(1,50,100),"Species"] = NA

# replace some numeric with NA's
iris_with_missing[c(2,79,112),c("Sepal.Length","Petal.Length")] = NA



cleanData.func <- function(data){
  data = as.data.frame(data)
  # identify character variables and numeric variables

  # numeric vars
  numericVars = which(sapply(data, is.numeric)==TRUE)
 
  # character vars
  characterVars = which(sapply(data, is.character)==TRUE)
  
  # replace NA character vars with "Virginica"
  for (i in 1:length(characterVars)){
    
    var = characterVars[[i]]
    
    data[is.na(data[,var]),var]="Virginica"
    
  }

  # replace NA numeric vars with the mean of that variable
  for (i in 1:length(numericVars)){
    
    var = numericVars[[i]]
    
    data[is.na(data[,var]),var]=mean(data[,var],na.rm = TRUE)
    
  }

  # return the cleaned data
  return(data)
  
}


iris_with_missing <- cleanData.func(iris_with_missing)
iris_with_missing

final = map_df(.x = iris_with_missing, ~cleanData.func(.x))
```

__Problem 2__

made a dataframe with all the file names from the `data` folder in the `_MACOSX`
folder

Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe

```{r}
data = list.files(path = "./data")
read_data = function(x){
  
  str_c("./data/", x) %>% 
    read_csv(x)
}

data_2 = map(data, read_data)


```

Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

```{r}
read_csv("./hw5_data/data/exp_01.csv") %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "value"
  ) %>% 
  view()
```
```{r}
read_data = function(x){
  
  str_c("./data/", x) %>% 
    read_csv(x)
}

macosx = tibble(
  files = list.files(path = "./data/"),
  path_name = str_c("./data/", files))

tidy_macosx = macosx %>% 
  mutate(
    file_data = map(macosx %>%  
                 pull(path_name), read_data)) %>% 
  select(files, file_data) %>% 
  unnest(cols = file_data) %>% 
  janitor::clean_names() %>% 
 pivot_longer(
    week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "value") %>% 
  separate(files, into = c("arm", "observation"), sep = "_") %>% 
  mutate(
    weekly_obs = str_replace(observation, "\\.csv", "")
  )
```

__Problem 3__

First set the following design elements:

Fix n=30
Fix xi1 as draws from a standard Normal distribution
Fix β0=2
Fix σ2=50
Set β1=0. Generate 10000 datasets from the model
yi=β0+β1xi1+ϵi

```{r}
n = 30
xi1 = rnorm
```

